---
title: Query Key ê´€ë¦¬í•˜ê¸° - query key factories
description: 
stage: evergreen
date: 2024-12-20
lastmod: 2025-03-22
tags:
  - post
  - tanstack-query
  - query-key
category: Library
enableToc: true
type: note
imageNameKey: posts
draft: false
---

## ğŸ’¡ ì¿¼ë¦¬í‚¤ ê´€ë¦¬ íŒ - QueryKey factory

> ë°°ê²½

ì¿¼ë¦¬í‚¤ì— paramsë¥¼ í¬í•¨í•˜ë©´ì„œ í˜ì´ì§€ë¥¼ paramë³„ë¡œ ìºì‹±í•˜ë ¤ë‹ˆ ì¢€ ë” ì •ëˆëœ ì¿¼ë¦¬í‚¤ ì‚¬ìš©ì´ í•„ìš”í–ˆë‹¤. ë°°ì—´ì´ ê¸¸ì–´ì§€ë‹¤ ë³´ë‹ˆ í—·ê°ˆë¦¬ê¸°ë„ í•˜ê³ , ë³€ìˆ˜ë¡œ ì²´ê³„í™” ì‹œì¼œì„œ ì¤‘ì•™ì—ì„œ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ì„ ê²ƒ ê°™ì•˜ë‹¤.

## ğŸ” Research

ê´€ë ¨ ì˜ˆì‹œë¥¼ ì°¾ë˜ ë„ì¤‘, Tanstack-queryë¥¼ ê´€ë¦¬í•˜ëŠ” ê°œë°œìì˜ ë¸”ë¡œê·¸(TkDodo)ì—ì„œ ì¿¼ë¦¬í‚¤ ê´€ë¦¬ ë°©ì‹ì— ëŒ€í•œ í¬ìŠ¤íŠ¸ë¥¼ ë°œê²¬í–ˆë‹¤. [^1]
ì»¤ë®¤ë‹ˆí‹°ì—ì„œë„ ì´ëŸ° íŒ¨í„´ì„ í™•ì¥í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ìˆëŠ”ë°, ê°€ì¥ ì¸ê¸°ìˆëŠ” ê²ƒì€ `@lukemorales/query-key-factory[^2]`ì´ë‹¤. <br>
ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” íƒ€ì… ì•ˆì „í•œ ì¿¼ë¦¬í‚¤ ìƒì„±ê³¼ ìë™ ì™„ì„± ê¸°ëŠ¥ì„ ì œê³µí•˜ë©°, íŠ¹íˆ TypeScript í”„ë¡œì íŠ¸ì—ì„œ ìœ ìš©í•˜ë‹¤.
ê·¸ì¹˜ë§Œ ì´ ê¸€ì—ì„œëŠ” ì¿¼ë¦¬í‚¤ íŒ¨í„´ ë¹„êµí•˜ëŠ” ê²ƒì´ ëª©ì ì´ë¼ ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë‹¤ë£¨ì§€ ì•ŠëŠ”ë‹¤.

## ì¿¼ë¦¬í‚¤ ë¹„êµ ë¶„ì„: ë°°ì—´ ê¸°ë°˜ vs ê°ì²´ ê¸°ë°˜

### ë³´í†µì˜ ë°°ì—´ ê¸°ë°˜ ì¿¼ë¦¬í‚¤

> ë°°ì—´ì— ì›ì‹œê°’ìœ¼ë¡œ ë‚˜ì—´

```ts
const getAllUsers = useQuery(["users"]) // ["users"] ì¿¼ë¦¬í‚¤ì— ì— getAllUsersë¡œ fetchí•œ ë°ì´í„°ê°€ ì €ì¥ë¨
const getUserById = useQuery(["users", userId]) // ["users", userId] ì¿¼ë¦¬í‚¤ì— getUserByIdë¡œ fetchí•œ ë°ì´í„°ê°€ ì €ì¥ë¨
```

### TkDodoì˜ ê°ì²´ ê¸°ë°˜ ì¿¼ë¦¬í‚¤ íŒ¨í„´

> TkDodoëŠ” ëª¨ë“  ì¿¼ë¦¬í‚¤ë¥¼ **ë°°ì—´ ì•ˆì˜ ë‹¨ì¼ ê°ì²´**ë¡œ í‘œí˜„í•˜ëŠ” ë°©ì‹ì„ ê¶Œì¥í•œë‹¤.

```ts
// ì¤‘ì•™ì—ì„œ ì¿¼ë¦¬í‚¤ë¥¼ ë³€ìˆ˜ë¡œ ê´€ë¦¬í•˜ë©° ë§¤ì„œë“œë¡œ ìƒì„±
const todoKeys = {
  // âœ… all keys are arrays with exactly one object
  // = ëª¨ë“  í‚¤ëŠ” ì •í™•íˆ í•˜ë‚˜ì˜ ê°ì²´ë¥¼ í¬í•¨í•œ ë°°ì—´
  all: [{ scope: "todos" }] as const,
  lists: () => [{ ...todoKeys.all[0], entity: "list" }] as const, // [{scope: "todos", entity: "list"}]
  list: (state: State, sorting: Sorting) => [{ ...todoKeys.lists()[0], state, sorting }] as const,
  // [{scope: "todos", entity: "list", state, sorting}]
}
```

ì´ íŒ¨í„´ì˜ í•µì‹¬:

- **ëª¨ë“  ì¿¼ë¦¬í‚¤ê°€ ì •í™•íˆ í•˜ë‚˜ì˜ ê°ì²´ë¥¼ í¬í•¨í•œ ë°°ì—´ë¡œ êµ¬ì„±**
- **ê°ì²´ ë‚´ë¶€ì— ëª¨ë“  í•„ìš”í•œ ë°ì´í„°ë¥¼ í‚¤-ê°’ ìŒìœ¼ë¡œ í‘œí˜„**
  - ì˜ˆ: `scope: "todos"`, `entity: "list"`, `id: 5` ë“±

### ë°°ì—´ ê¸°ë°˜ ì¿¼ë¦¬í‚¤ì˜ í•œê³„

> ì¼ë°˜ ì›ì‹œê°’ì˜ ìš”ì†Œì˜ ë°°ì—´ì‹œ ìˆœì„œì— ì˜ì¡´í•˜ê¸° ë•Œë¬¸ì— ìˆœì„œê°€ ë°”ë€”ì‹œ ë‹¤ë¥¸ ì¿¼ë¦¬ë¡œ ì¸ì‹ë¨ âš ï¸

```ts
const getAllUsers = useQuery(["users"])
const getUserById = useQuery(["users", userId])
const getUserPosts = useQuery(["users", userId, "posts"])

// getUserPostsì™€ ê³µì§‘í•©ì´ì§€ë§Œ, ìˆœì„œê°€ ë‹¬ë¼ ë¬´íš¨í™” ì˜¤ë¥˜ ë°œìƒí•¨.
queryClient.invalidateQueries({ queryKey: ["posts", userId, "users"] })
```

### ê¶Œì¥ë˜ëŠ” ë°©ì‹: TkDodoì˜ ë‹¨ì¼ ê°ì²´ íŒ¨í„´

> ìœ„ì˜ ë¬¸ì œëŠ” TkDodoê°€ ì œì•ˆí•œ ë‹¨ì¼ ê°ì²´ íŒ¨í„´ìœ¼ë¡œ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

```js
// ë‹¨ì¼ ê°ì²´ íŒ¨í„´ìœ¼ë¡œ ê°œì„ 
const getUsersQueries = {
  all: [{ entity: "users" }],
  detail: (userId) => [{ entity: "users", id: userId }],
  posts: (userId) => [{ entity: "users", id: userId, relation: "posts" }],
}

// ì‚¬ìš© ì˜ˆì‹œ
const { data: allUsers } = useQuery({ queryKey: getUsersQueries.all })
const { data: user } = useQuery({ queryKey: getUsersQueries.detail(5) })
const { data: userPosts } = useQuery({ queryKey: getUsersQueries.posts(5) })

// ê°ì²´ ì†ì„±(properties) ê¸°ë°˜ ë§¤ì¹­
queryClient.invalidateQueries({ queryKey: [{ entity: "users", id: 5 }] })
```

ì´ ë°©ì‹ì€ **ê°ì²´ ì†ì„±(properties) ê¸°ë°˜ìœ¼ë¡œ ë§¤ì¹­**ë˜ë¯€ë¡œ ìˆœì„œì— ì˜ì¡´í•˜ì§€ ì•Šê³ , ë” ìœ ì—°í•œ ì¿¼ë¦¬ ê´€ë¦¬ê°€ ê°€ëŠ¥í•˜ë‹¤.

<br>

### ì¿¼ë¦¬ ë¹„êµ ì•Œê³ ë¦¬ì¦˜ ì´í•´í•˜ê¸°

Tanstack-query ê³µì‹ë¬¸ì„œ[^3]ì— ë”°ë¥´ë©´ `invalidateQueries`ë‚˜ `removeQueries` ê°™ì€ ë©”ì„œë“œë¥¼ ì‚¬ìš©ì‹œ, ê¹Šì€ ë¶€ë¶„ ì¼ì¹˜ ê²€ìƒ‰(deep partial matching: ê°ì²´ì˜ ì†ì„±ë“¤ì´ ë¶€ë¶„ì ìœ¼ë¡œ ì¼ì¹˜í•˜ëŠ”ì§€ ê¹Šê²Œ ê²€ì‚¬í•˜ëŠ” ì•Œê³ ë¦¬ì¦˜) ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•œë‹¤ ì†Œê°œí•œë‹¤.<br>
ì´ ì•Œê³ ë¦¬ì¦˜ì€ ì¿¼ë¦¬í‚¤ì˜ prefix(ì ‘ë‘ì‚¬) ê¸°ë°˜ìœ¼ë¡œ ì‘ë™í•˜ê¸° ë•Œë¬¸ì— ë°°ì—´ì˜ ì²« ë¶€ë¶„ë¶€í„° ìˆœì„œê°€ ì¼ì¹˜í•´ì•¼ í•œë‹¤. ì¦‰, ìºì‹œëœ í€´ë¦¬í‚¤ì˜ ì‹œì‘ë¶€ë¶„ì´ ë¬´íš¨í™”í•˜ë ¤ëŠ” íŒ¨í„´ê³¼ ì •í™•íˆ ì¼ì¹˜í•´ì•¼ ëœë‹¤.

### ì¿¼ë¦¬ ë¹„êµ ì•Œê³ ë¦¬ì¦˜

> **ì •í™•íˆ ì–´ë–»ê²Œ ë¹„êµí• ê¹Œ?** <br> [TanStack Queryì˜ ê¹ƒí—ˆë¸Œ ì†ŒìŠ¤ ì½”ë“œë¥¼ ë‹¨ìˆœí™”í•œ ì•Œê³ ë¦¬ì¦˜:](https://github.com/TanStack/query/blob/9e414e8b4f3118b571cf83121881804c0b58a814/src/core/utils.ts#L321-L338)

```ts
// queryKey ë¹„êµ ì•Œê³ ë¦¬ì¦˜ (ë‹¨ìˆœí™”ë¨)
export function partialMatchKey(a: QueryKey, b: QueryKey): boolean {
  return partialDeepEqual(a, b)
}

// ê°ì²´ì˜ ë¶€ë¶„ ì¼ì¹˜ë¥¼ í™•ì¸í•˜ëŠ” í•¨ìˆ˜
function partialDeepEqual(a: any, b: any): boolean {
  // 1. ë‘ ê°’ì´ ì •í™•íˆ ê°™ë‹¤ë©´ ì¼ì¹˜
  if (a === b) {
    return true
  }

  // 2. íƒ€ì…ì´ ë‹¤ë¥´ë©´ ë¶ˆì¼ì¹˜
  if (typeof a !== typeof b) {
    return false
  }

  // 3. ë‘ ê°’ì´ ëª¨ë‘ ê°ì²´ì¸ ê²½ìš°
  if (a && b && typeof a === "object" && typeof b === "object") {
    // bì˜ ëª¨ë“  ì†ì„±ì´ aì— ì¡´ì¬í•˜ê³  ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
    return !Object.keys(b).some((key) => !partialDeepEqual(a[key], b[key]))
  }

  return false
}
```

#### ë‹¨ë°©í–¥ ë§¤ì¹­ ì´í•´í•˜ê¸°

ì´ ë¹„êµ ì•Œê³ ë¦¬ì¦˜ì€ **ë‹¨ë°©í–¥**ìœ¼ë¡œ ë™ì‘í•œë‹¤ëŠ”ê±¸ ì´í•´í•˜ëŠ”ê²Œ ì¤‘ìš”í•˜ë‹¤.

- TanStack QueryëŠ” ìºì‹œëœ ì¿¼ë¦¬í‚¤(a)ì™€ ë¬´íš¨í™” íŒ¨í„´(b)ì„ ë¹„êµí•œë‹¤.
- ë¬´íš¨í™” íŒ¨í„´(b)ì´ ìºì‹œëœ ì¿¼ë¦¬í‚¤(a)ì˜ ë¶€ë¶„ ì§‘í•©ì¸ì§€ í™•ì¸í•œë‹¤.
- ì¦‰, "ë¬´íš¨í™” íŒ¨í„´ì˜ ëª¨ë“  ì†ì„±ì´ ìºì‹œëœ ì¿¼ë¦¬í‚¤ì—ë„ ìˆê³  ê°’ì´ ê°™ì€ê°€?"ë¥¼ ê²€ì‚¬í•œë‹¤.

ì´ëŠ” ì‹¤ì œ ì¤‘ì²©ëœ ì¿¼ë¦¬í‚¤ë¥¼ ë¬´íš¨í™”í•˜ëŠ”ë° ì¤‘ìš”í•œ íŠ¹ì„±ì´ë‹¤.

#### ì˜ˆì œë¡œ ì´í•´í•˜ê¸°

ì˜ˆë¥¼ ë“¤ì–´, ë‹¤ìŒê³¼ ê°™ì€ ì¿¼ë¦¬í‚¤ê°€ ìˆë‹¤ê³  ê°€ì •í•´ë³´ì.

**1. ìºì‹œì— ìˆëŠ” ì¿¼ë¦¬í‚¤ë“¤**

```
1. [{ scope: 'users', id: 5, entity: 'detail' }]
2. [{ scope: 'users', id: 5, subEntity: 'posts' }]
3. [{ scope: 'users', id: 7, subEntity: 'posts' }]
4. [{ scope: 'posts', id: 10 }]
```

**2. ë¬´íš¨í™” ëª…ë ¹ì„ ì‹¤í–‰:**

```js
queryClient.invalidateQueries({
  queryKey: [{ scope: "users", id: 5 }],
})
```

**3. ê²°ê³¼:**

1. ì¿¼ë¦¬ 1: âœ… ë¬´íš¨í™” ë¨ (íŒ¨í„´ì˜ ëª¨ë“  ì†ì„±ì´ í¬í•¨ë¨)
2. ì¿¼ë¦¬ 2: âœ… ë¬´íš¨í™” ë¨ (íŒ¨í„´ì˜ ëª¨ë“  ì†ì„±ì´ í¬í•¨ë¨)
3. ì¿¼ë¦¬ 3: âŒ ë¬´íš¨í™” ì•ˆë¨ (idê°€ ë‹¤ë¦„)
4. ì¿¼ë¦¬ 4: âŒ ë¬´íš¨í™” ì•ˆë¨ (scopeì´ ë‹¤ë¦„)

**4. ë‹¤ì‹œ, ì™œ "ë‹¨ë°©í–¥"ì¸ê°€?**

- ë¬´íš¨í™” íŒ¨í„´(b)ì´ ì¿¼ë¦¬í‚¤(a)ì˜ ë¶€ë¶„ ì§‘í•©ì¸ì§€ë§Œ í™•ì¸.
- ì—­ë°©í–¥(ì¿¼ë¦¬í‚¤ê°€ íŒ¨í„´ì˜ ë¶€ë¶„ ì§‘í•©ì¸ì§€)ì€ í™•ì¸í•˜ì§€ ì•ŠìŒ.

## ê°ì²´ ê¸°ë°˜ ì¿¼ë¦¬í‚¤ íŒ©í† ë¦¬ êµ¬ì¡°ì™€ í™œìš©

> ê°ì²´ ê¸°ë°˜ ì¿¼ë¦¬í‚¤ íŒ©í† ë¦¬ì˜ ê³„ì¸µì  êµ¬ì¡°ì™€ ë©”ì„œë“œë³„ ì—­í• :

```ts
const userKeys = {
  // 1. ê¸°ë³¸ ìŠ¤ì½”í”„ ì •ì˜
  all: [{ scope: "users" }] as const,

  // 2. entity: list êµ¬ì¡° ìƒì„±
  lists: () => [{ ...userKeys.all[0], entity: "list" }] as const,
  list: (filters = {}) => [{ ...userKeys.lists()[0], ...filters }] as const,

  // ì´ í›„ entity ë³„ë¡œ ë©”ì„œë“œ ì¶”ê°€ (ì˜ˆì‹œ: detail)
  details: () => [{ ...userKeys.all[0], entity: "detail" }] as const,
  detail: (userId) => [{ ...userKeys.details()[0], id: userId }] as const,

  ...
}
```

### ë©”ì„œë“œ ê°„ì˜ ê³„ì¸µ êµ¬ì¡°

```text

userKeys.all â†’ ê¸°ë³¸ ë„ë©”ì¸ ì •ì˜
  â”œâ”€â”€ userKeys.lists() â†’ ëª©ë¡ ê´€ë ¨ ê¸°ë³¸ êµ¬ì¡°
  â”‚     â””â”€â”€ userKeys.list(filters) â†’ ìµœì¢… ëª©ë¡ ì¿¼ë¦¬ (í•„í„° í¬í•¨)
  â”‚
  â””â”€â”€ userKeys.details() â†’ ìƒì„¸ ì •ë³´ ê¸°ë³¸ êµ¬ì¡°
        â””â”€â”€ userKeys.detail(userId) â†’ íŠ¹ì • ì‚¬ìš©ì ìƒì„¸ ì •ë³´


```

### ë©”ì„œë“œ êµ¬ì¡° (Domain > Entity > Query)

#### **1. `userKeys.all` - ê¸°ë³¸ ìŠ¤ì½”í”„**

- ëª¨ë“  users ê´€ë ¨ ì¿¼ë¦¬ë¥¼ í•œ ë²ˆì— ë¬´íš¨í™”í•  ë•Œ ìœ ìš©
- ë°˜í™˜ê°’: `[{ scope: "users" }]`
- ì˜ˆ: `queryClient.invalidateQueries({ queryKey: userKeys.all })`

#### **2-1. `userKeys.lists()` - ëª©ë¡ ê¸°ë³¸ ì¿¼ë¦¬í‚¤**

- ëª¨ë“  usersì˜ list(ëª©ë¡) ì¿¼ë¦¬í‚¤
- ëª¨ë“  list ì¿¼ë¦¬(í•„í„°ì™€ ìƒê´€ì—†ì´)ë¥¼ ë¬´íš¨í™”í•  ë•Œ ì‚¬ìš©
- ë°˜í™˜ê°’: `[{ scope: "users", entity: "list" }]`
- ì˜ˆ: `queryClient.invalidateQueries({ queryKey: userKeys.lists() })`

#### **2-2. `userKeys.list(filters)` - í•„í„°ê°€ ì ìš©ëœ list ì¿¼ë¦¬í‚¤**

- êµ¬ì²´ì ì¸ í•„í„°ê°€ ì¶”ê°€ëœ list ì¿¼ë¦¬í‚¤
- íŠ¹ì • í•„í„° ì¡°ê±´ì˜ ëª©ë¡ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ê±°ë‚˜ ë¬´íš¨í™”í•  ë•Œ ì‚¬ìš©
- ë°˜í™˜ê°’: `[{ scope: "users", entity: "list", filters }]`
- ì˜ˆ: íŠ¹ì • í˜ì´ì§€ ëª©ë¡ ì¡°íšŒ: `useQuery({ queryKey: userKeys.list({ page: 1, limit: 10 }) })`

### ê°ì²´ ê¸°ë°˜ ì¿¼ë¦¬í‚¤ì˜ ì¥ì 

- ìœ ì—°í•œ ì¿¼ë¦¬ ë¬´íš¨í™”: ê°ì²´ì˜ properties(í”„ë¡œí¼í‹°)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ë” ìœ ì—°í•˜ê²Œ ë¬´íš¨í™”í•  ìˆ˜ ìˆìŒ
- êµ¬ì¡° ë¶„í•´ë¥¼ í†µí•œ ëª…í™•í•œ ì ‘ê·¼: ì¿¼ë¦¬ í•¨ìˆ˜ì—ì„œ ê°ì²´ì˜ ëª…ëª…ëœ ì†ì„±ìœ¼ë¡œ ë°”ë¡œ ì ‘ê·¼ ê°€ëŠ¥

```ts
// ì¿¼ë¦¬ í•¨ìˆ˜ì—ì„œ êµ¬ì¡° ë¶„í•´ í™œìš©í•˜ê¸°
const fetchTodos = async ({
  // ì¿¼ë¦¬í‚¤ì˜ ì²« ë²ˆì§¸ ìš”ì†Œê°€ ê°ì²´ì´ë¯€ë¡œ ëª…ëª…ëœ ì†ì„±ìœ¼ë¡œ ë°”ë¡œ ì ‘ê·¼ ê°€ëŠ¥
  queryKey: [{ state, sorting, filters }],
}: QueryFunctionContext<ReturnType<typeof todoKeys.list>>) => {
  // âœ… URL ë¹Œë“œì‹œ ìœ„ì¹˜ê°€ ì•„ë‹Œ ì†ì„±ëª…ìœ¼ë¡œ ì ‘ê·¼í•˜ë¯€ë¡œ ì•ˆì „
  const response = await axios.get(`todos/${state}?sorting=${sorting}&limit=${filters.limit}`)
  return response.data
}
```

## ë‚´ í”„ë¡œì íŠ¸ì— ì ìš©í•˜ê¸°

### ê°ì²´ ê¸°ë°˜ ë°©ì‹ ì ìš©ì‹œ ê³ ë ¤ ì‚¬í•­

ê°ì²´ ê¸°ë°˜ ë°©ì‹ì˜ ê°€ì¥ í° ì¥ì ì€ ì†ì„± ê¸°ë°˜ ë§¤ì¹­ì„ í†µí•œ ìœ ì—°í•œ ì¿¼ë¦¬ ê´€ë¦¬ì´ë‹¤. ì´ë¥¼ ìµœëŒ€í•œ í™œìš©í•˜ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì§ì ‘ ì†ì„±ê°’ì„ ì§€ì •í•˜ì—¬ ë¬´íš¨í™”í•˜ëŠ” ê²ƒì´ ê°€ì¥ íš¨ê³¼ì ì´ë‹¤.
(ê°€ë…ì„± ì¢‹ê³ , í¸ë¦¬í•¨)

```ts
// ì†ì„±ê°’ìœ¼ë¡œ ì‰½ê²Œ ë¬´íš¨í™” í•˜ê¸°
// ëª¨ë“  íˆ¬ë‘ ì‚­ì œ
queryClient.removeQueries({
  queryKey: [{ scope: "todos" }],
})

// todos ë„ë©”ì¸ ì•ˆì— ëª¨ë“  ëª©ë¡ ë¦¬ì…‹
queryClient.resetQueries({
  queryKey: [{ scope: "todos", entity: "list" }],
})

// ì–´ëŠ ë„ë©”ì¸ì´ë“  ëª¨ë“  ëª©ë¡ ë¬´íš¨í™” (ì‹¤ìˆ˜ë¡œ ë‹¤ë¥¸ ë„ë©”ì¸ì˜ listê¹Œì§€ ë¬´íš¨í™” ë  ìˆ˜ ìˆìŒ)
queryClient.invalidateQueries({
  queryKey: [{ entity: "list" }],
})
```

#### í•˜ë“œ ì½”ë“œ ë°©ì‹ì˜ ë¬¸ì œ

ê·¸ëŸ¬ë‚˜ ì´ ì¥ì ì„ ìœ„í•´ í•˜ë“œ ì½”ë”©ìœ¼ë¡œ ì¿¼ë¦¬í‚¤ ì‘ì„±ì‹œ ì•„ë˜ì™€ ê°™ì€ ë¬¸ì œì ì´ ìˆë‹¤.

- ì†ì„± ì´ë¦„ ì˜¤íƒ€: scopeë¥¼ scopìœ¼ë¡œ ì˜ëª» ì…ë ¥í•˜ë©´ ì•„ë¬´ ì¿¼ë¦¬ë„ ë¬´íš¨í™”ë˜ì§€ ì•ŠìŒ
- êµ¬ì¡° ë³€ê²½ ì‹œ ìœ„í—˜: ë‚˜ì¤‘ì— íŒ©í† ë¦¬ êµ¬ì¡°ë¥¼ ë³€ê²½í•˜ë©´ í•˜ë“œì½”ë”©ëœ ê°ì²´ì™€ ë¶ˆì¼ì¹˜ ë°œìƒ
- ì¼ê´€ì„± ìœ ì§€ ì–´ë ¤ì›€: íŒ€ì›ë“¤ì´ ê°ì ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ê°ì²´ë¥¼ êµ¬ì„±í•  ìœ„í—˜

#### íŒ©í† ë¦¬ ë§¤ì„œë„ í˜¸ì¶œì„ í†µí•œ ëŒ€ì•ˆ

ë¬¼ë¡  ì¤‘ì•™ì—ì„œ ê´€ë¦¬í•˜ê¸° ë–„ë¬¸ì— í•˜ë“œì½”ë”© ë§ê³  íŒ©í† ë¦¬ í•¨ìˆ˜ë¥¼ í†µí•œ ìŠ¤ì½”í”„ ë¬´ê´€ ë¬´íš¨í™” í•  ìˆ˜ ìˆë‹¤.

```js
// íŒ©í† ë¦¬ ë§¤ì„œë“œë¥¼ í˜¸ì¶œ í•´ ì‚¬ìš© | í•˜ë“œì½”ë”© âŒ
queryClient.invalidateQueries({
  queryKey: todoKeys.lists(), // [{ scope: "todos", entity: "list" }]
})
```

ê·¸ëŸ¬ë‚˜ ì´ëŸ° ì‹ìœ¼ë¡œ í™œìš©ëœë‹¤ë©´, ê°ì²´ ê¸°ë°˜ ì ‘ê·¼ë²•ì˜ ì¥ì ì¸ ê°€ë…ì„±ê³¼ í¸ë¦¬ì„±ì´ ìƒì‡„ëœë‹¤.

ë‚˜ëŠ” ì• ì´ˆì— ëª¨ë“  ì¿¼ë¦¬í‚¤ë¥¼ ë³€ìˆ˜ë¡œ ë‘¬ ì¤‘ì•™ì—ì„œ í•œë²ˆì— ê´€ë¦¬í•˜ëŠ”ê²ƒì— ì œì¼ ìš°ì„ ìˆœìœ„ì´ê¸° ë•Œë¬¸ì—, ì´ ì¥ì ì—ë„ ë¶ˆêµ¬ í•˜ë“œì½”ë”©ì€ í”¼í•˜ê³  ì‹¶ì—ˆê³ ,
ì´ ì¥ì ì„ í¬ê¸°í•˜ë‹ˆ ë°°ì—´ + ê°ì²´ ì ‘ê·¼ë²•ì´ í›¨ì”¬ í¸ë¦¬í•˜ë‹¤ íŒë‹¨í–ˆë‹¤.

### ë‚´ ì±„íƒí•œ ë°©ì‹

> ë‚´ í”„ë¡œì íŠ¸ì—ì„œ ì„ íƒí•œ ë°©ì‹ì€ ë°°ì—´ + ê°ì²´ ì ‘ê·¼ë²•ì´ë‹¤.

ë‚˜ëŠ” ì• ì´ˆì— ëª¨ë“  ì¿¼ë¦¬í‚¤ë¥¼ ë³€ìˆ˜ë¡œ ë‘ì–´ ì¤‘ì•™ì—ì„œ ê´€ë¦¬í•˜ëŠ” ê²ƒì„ ìµœìš°ì„ ìœ¼ë¡œ ìƒê°í–ˆê¸° ë•Œë¬¸ì—, ê°ì²´ ê¸°ë°˜ì˜ ìœ ì—°ì„±ë³´ë‹¤ íŒ©í† ë¦¬ í•¨ìˆ˜ë¥¼ í†µí•œ ì•ˆì „ì„±ì„ ì„ íƒí–ˆë‹¤.
ì´ëŸ¬í•œ ìƒí™©ì—ì„œëŠ” ë°°ì—´ + ê°ì²´(ê°€ë³€ì´ ë†’ì€ ë§¤ê°œë³€ìˆ˜ ê·¸ë£¹í™”) í˜¼í•© ì ‘ê·¼ë²•ì´ ë” ì§ê´€ì ì´ê³  í¸ë¦¬í•˜ë‹¤ê³  íŒë‹¨í–ˆë‹¤.

```js
// ì¤‘ì•™ì—ì„œ ê´€ë¦¬í•˜ëŠ” ì¿¼ë¦¬í‚¤ íŒ©í† ë¦¬
export const workKey = {
  all: ["works"],
  // ë°˜í™˜ê°’: ["works"]

  lists: () => [...workKey.all, "list"],
  // ë°˜í™˜ê°’: ["works", "list"]

  list: (challengeId, params = {}) => [...workKey.lists(), challengeId, { ...params }],
  // ë°˜í™˜ê°’: ["works", "list", challengeId, { ...params }]

  details: () => [...workKey.all, "detail"],
  // ë°˜í™˜ê°’: ["works", "detail"]

  detail: (workId) => [...workKey.details(), workId],
  // workKey.detail(8) ë°˜í™˜ê°’: ["works", "detail", 8]

  feedbacks: (workId) => [...workKey.detail(workId), "feedbacks"],
  // workKey.feedbacks(5) ë°˜í™˜ê°’: ["works", "detail", 5, "feedbacks"]
}
```

```js
// í•­ìƒ íŒ©í† ë¦¬ ë§¤ì„œë“œë¥¼ í˜¸ì¶œ í•´ ì‚¬ìš© | í•˜ë“œì½”ë”© âŒ
console.log(workKey.list(challengeId, { ...params }))
// ë°˜í™˜ê°’: ["works", "list", challengeId, { ...params }]
```

#### íŠ¹ì§•

REST API êµ¬ì¡°ì™€ ìœ ì‚¬í•œ ê³„ì¸µì  êµ¬ì¡° íŒ¨í„´ìœ¼ë¡œ ì ‘ê·¼í–ˆë‹¤.

- [0]ì¸ë±ìŠ¤: ë°ì´í„° ë„ë©”ì¸(DB ì—”í‹°í‹°) - "works"
- [1]ì¸ë±ìŠ¤: ì¡°íšŒ ìœ í˜• - "list" ë˜ëŠ” "detail"
- [2]ì¸ë±ìŠ¤: ì‹ë³„ì - challengeId ë˜ëŠ” workId
- [3]ì¸ë±ìŠ¤: ê°€ë³€ì ì¸ ë§¤ê°œë³€ìˆ˜ - {í•„í„°ë§, ì •ë ¬, í˜ì´ì§€ë„¤ì´ì…˜ ë“±}

### ì±„íƒ ì´ìœ 

#### í”„ë¡œì íŠ¸ ì í•©ì„±

- ëª…í™•í•œ ë„ë©”ì¸ êµ¬ì¡°ì— ì í•© ("works", "challenges" ë“±)
- ë°±ì—”ë“œ API êµ¬ì¡°ì™€ ì¼ê´€ì„± ìœ ì§€ (REST íŒ¨í„´)
- íŒ€ì›ë“¤ì˜ ì´í•´ë„ê°€ ë†’ìŒ
- ì¤‘ì†Œ ê·œëª¨ í”„ë¡œì íŠ¸ì— ì¶©ë¶„í•œ ê¸°ëŠ¥ ì œê³µ
- ì¤‘ì•™ ê´€ë¦¬ ë°©ì‹ì— ìµœì í™”

#### ê¸°ìˆ ì  ì¥ì 

- í•˜ë“œì½”ë”© ì—†ì´ íŒ©í† ë¦¬ ë©”ì„œë“œ ì‚¬ìš©ìœ¼ë¡œ ì‹¤ìˆ˜ ë°©ì§€
- ì˜¤íƒ€ ìœ„í—˜ ê°ì†Œ
- ëª…í™•í•œ ê³„ì¸µ êµ¬ì¡° (ì˜ˆ: ['works', 'list', challengeId])
- query params ê°™ì€ ê·¸ë£¹í™” ì‹œí‚¤ê¸° ì¢‹ì€ ê°€ë³€ ë§¤ê°œë³€ìˆ˜ë§Œ ê°ì²´ë¡œ ê´€ë¦¬í•˜ì—¬ ìœ ì—°ì„± í™•ë³´
- ê³„ì¸µì  ë„ë©”ì¸ ë¶„ë¦¬ê°€ ëª…í™•í•˜ì—¬ ì˜ë„ì¹˜ ì•Šì€ ë¬´íš¨í™” ë°©ì§€

### ë‘ ì ‘ê·¼ë²• ë¹„êµ ì •ë¦¬

| íŠ¹ì„±        | TkDodo ê°ì²´ ê¸°ë°˜                      | ë‚´ ë°°ì—´ ê¸°ë°˜ ì ‘ê·¼ë²•                |
| ----------- | ------------------------------------- | ---------------------------------- |
| ìœ ì—°ì„±      | ì†ì„± ê¸°ë°˜ ë§¤ì¹­ìœ¼ë¡œ ë§¤ìš° ìœ ì—°í•¨        | prefix ê¸°ë°˜ ë§¤ì¹­ìœ¼ë¡œ ìœ ì—°ì„± ì œí•œì  |
| ì§ê´€ì„±      | ê°ì²´ ì†ì„±ìœ¼ë¡œ êµ¬ë¶„í•˜ì—¬ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŒ | REST APIì™€ ìœ ì‚¬í•´ ì§ê´€ì            |
| íƒ€ì… ì•ˆì „ì„± | TypeScriptì™€ ê²°í•© ì‹œ ë›°ì–´ë‚¨           | ìœ„ì¹˜ ê¸°ë°˜ì´ë¼ íƒ€ì… ì•ˆì „ì„± ë‚®ìŒ     |
| êµ¬ì¡° ë¶„í•´   | ëª…ëª…ëœ ì†ì„±ìœ¼ë¡œ ì ‘ê·¼ ìš©ì´             | ìœ„ì¹˜ ê¸°ë°˜ ì ‘ê·¼ìœ¼ë¡œ ì˜¤ë¥˜ ê°€ëŠ¥ì„±     |
| ì í•©í•œ ìƒí™© | ë³µì¡í•œ ëŒ€ê·œëª¨ í”„ë¡œì íŠ¸                | êµ¬ì¡°ê°€ ëª…í™•í•œ ì†Œê·œëª¨ í”„ë¡œì íŠ¸      |

### ë°°ì—´ + ê°ì²´ ë°©ì‹ì˜ ì œí•œ ì‚¬í•­

ê·¸ëŸ¬ë‚˜ ì—­ì‹œ ê° ë°©ë²•ì´ ì¥ë‹¨ì ì´ ìˆê¸° ë•Œë¬¸ì— í”„ë¡œì íŠ¸ íŠ¹ì„±ì— ë”°ë¼ ì í•©í•œ ë°©ë²•ì„ ì„ íƒí•´ì•¼ í•œë‹¤.
í˜„ì¬ í”„ë¡œì íŠ¸ ì‚¬ì´ì¦ˆì—ì„œëŠ” ì´ ë°©ì‹ì´ ë” ì ì ˆí•˜ë‹¤ íŒë‹¨ë˜ì§€ë§Œ í”„ë¡œì íŠ¸ê°€ ì„±ì¥í•˜ë©´ì„œ ë³µì¡í•œ ê´€ê³„ í‘œí˜„ì˜ ì–´ë ¤ìš´ ë¶€ë¶„ì€ í™•ì‹¤íˆ ìˆì—ˆë‹¤.
í•­ìƒ ê³„ì¸µì ì¸ ê´€ê³„ì¼ ìˆ˜ ë§Œì€ ì—†ê¸° ë•Œë¬¸ì— í™•ì¥ì„±ì„ ìœ„í•´ í˜„ì¬ì—ì„œ(ë¦¬ì•¡íŠ¸+ìë°”ìŠ¤í¬ë¦½íŠ¸) -> íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ì™€ ë„¥ìŠ¤íŠ¸ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ì‹œ íƒ€ì… ì•ˆì •ì„±ë„ ë³´ì¥í•˜ê³  ë” ìœ ì—°í•œ ê°ì²´ ê¸°ë°˜ ì ‘ê·¼ë²•ìœ¼ë¡œ ë¦¬íŒ©í† ë§ í• ê²ƒì´ë‹¤.

## ì •ë¦¬

### TkDodoì˜ ì¿¼ë¦¬í‚¤ íŒ©í† ë¦¬ì˜ ì¥ì 

- ì¿¼ë¦¬í‚¤ ê´€ë¦¬ ì¤‘ì•™í™”
- ì¿¼ë¦¬í‚¤ ìƒì„± ë¡œì§ ì¬ì‚¬ìš©ì„±
- ì¿¼ë¦¬í‚¤ ë¬´íš¨í™” ìœ ì—°ì„±
- íƒ€ì… ì•ˆì „ì„±

### ê³ ë ¤í•´ì•¼ í•  ë‹¨ì 

- ì´ˆê¸° ì„¤ì • ì˜¤ë²„í—¤ë“œ: ì¿¼ë¦¬í‚¤ íŒ©í† ë¦¬ íŒ¨í„´ì€ ì´ˆê¸° êµ¬í˜„ì— ì‹œê°„ì´ í•„ìš”.
- ê°„ë‹¨í•œ ì‚¬ìš© ì‚¬ë¡€ì—ì„œì˜ ë³µì¡ì„±: ë§¤ìš° ê°„ë‹¨í•œ ì•±ì—ì„œëŠ” ê³¼ë„í•œ ì¶”ìƒí™” ì¼ ìˆ˜ ìˆìŒ.
- í•™ìŠµ ê³¡ì„ : íŒ€ì›ë“¤ì´ ì´ íŒ¨í„´ì— ìµìˆ™í•´ì§€ëŠ” ë° ì‹œê°„ì´ í•„ìš”í•  ìˆ˜ ìˆìŒ.

ê°ì²´ ê¸°ë°˜ê³¼ ë°°ì—´ ê¸°ë°˜ ì ‘ê·¼ë²• ëª¨ë‘ ê°ìì˜ ì¥ë‹¨ì ì´ ìˆìœ¼ë©°, í”„ë¡œì íŠ¸ì˜ íŠ¹ì„±ê³¼ íŒ€ì˜ ì„ í˜¸ë„ì— ë”°ë¼ ì ì ˆí•œ ì ‘ê·¼ë²•ì„ ì„ íƒí•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•œê±° ê°™ë‹¤.

---

### â­ ë‹¤ìŒ ë‹¨ê³„ (What's Next?)

- [ ] í˜„ì¬ ë¦¬ì•¡íŠ¸ + ìë°”ìŠ¤í¬ë¦½íŠ¸ í”„ë¡œì íŠ¸ -> ë„¥ìŠ¤íŠ¸ + íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ë¡œ ì „í™˜í• ë•Œ TkDodoì˜ ë°©ì‹ìœ¼ë¡œ ì ìš©í•´ë³´ê¸°
- [ ] query key factory ê´€ë¦¬ í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ í™•ì¸í•´ë³´ê¸° [@lukemorales/query-key-factory](https://www.npmjs.com/package/@lukemorales/query-key-factory)
- [ ] ì¿¼ë¦¬ í•„í„° ê´€ë ¨ ë¬¸ì„œ ì •ë¦¬ (QueryFilter & MutationFilter) [ì¿¼ë¦¬ í•„í„° ê´€ë ¨ ë¬¸ì„œ](https://tanstack.com/query/latest/docs/framework/react/guides/filters#query-filters)

### ğŸ“š References & Resources

[Dorfmeister, D. 2021, "Leveraging the Query Function Context"](https://tkdodo.eu/blog/leveraging-the-query-function-context#query-key-factories)

### ğŸ“ ì—°ê´€ ë…¸íŠ¸

- ğŸŒ± **ì´ˆê¸° ì•„ì´ë””ì–´** [[My-Garden/Seedlings/query-key-factories | QueryKey factory ë¦¬ì„œì¹˜]]

---

[^1]: ë§í¬:[Leveraging the Query Function Context](https://tkdodo.eu/blog/leveraging-the-query-function-context#query-key-factories)

[^2]: ë§í¬:[@lukemorales/query-key-factory](https://www.npmjs.com/package/@lukemorales/query-key-factory)

[^3]: ë§í¬:[TanStack Query - Query Matching with invalidateQueries](https://tanstack.com/query/latest/docs/framework/react/guides/query-invalidation#query-matching-with-invalidatequeries)
